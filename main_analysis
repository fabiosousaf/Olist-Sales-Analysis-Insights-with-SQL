{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/fabiosantosf/olist-sales-analysis-insights-with-sql?scriptVersionId=273550982\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"code","execution_count":1,"id":"eb0264a6","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:30.321713Z","iopub.status.busy":"2025-11-05T00:16:30.321221Z","iopub.status.idle":"2025-11-05T00:16:33.205526Z","shell.execute_reply":"2025-11-05T00:16:33.204456Z"},"papermill":{"duration":2.893717,"end_time":"2025-11-05T00:16:33.207367","exception":false,"start_time":"2025-11-05T00:16:30.31365","status":"completed"},"tags":[]},"outputs":[],"source":["import pandas as pd\n","from pandasql import sqldf"]},{"cell_type":"code","execution_count":2,"id":"923036c2","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:33.215608Z","iopub.status.busy":"2025-11-05T00:16:33.215155Z","iopub.status.idle":"2025-11-05T00:16:35.266192Z","shell.execute_reply":"2025-11-05T00:16:35.264757Z"},"papermill":{"duration":2.057703,"end_time":"2025-11-05T00:16:35.268678","exception":false,"start_time":"2025-11-05T00:16:33.210975","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Carregando arquivos, isso pode levar um momento...\n","Dados carregados com sucesso!\n","As 'tabelas' customers, orders, etc., agora existem e estão prontas para serem usadas.\n"]}],"source":["# Célula 2: Carregando os arquivos de dados para a memória\n","\n","caminho_dados = '../input/brazilian-ecommerce/'\n","\n","print(\"Carregando arquivos, isso pode levar um momento...\")\n","\n","customers = pd.read_csv(caminho_dados + 'olist_customers_dataset.csv')\n","orders = pd.read_csv(caminho_dados + 'olist_orders_dataset.csv')\n","order_items = pd.read_csv(caminho_dados + 'olist_order_items_dataset.csv')\n","products = pd.read_csv(caminho_dados + 'olist_products_dataset.csv')\n","payments = pd.read_csv(caminho_dados + 'olist_order_payments_dataset.csv')\n","sellers = pd.read_csv(caminho_dados + 'olist_sellers_dataset.csv')\n","\n","print(\"Dados carregados com sucesso!\")\n","print(\"As 'tabelas' customers, orders, etc., agora existem e estão prontas para serem usadas.\")"]},{"cell_type":"markdown","id":"a37d7061","metadata":{"papermill":{"duration":0.004436,"end_time":"2025-11-05T00:16:35.277182","exception":false,"start_time":"2025-11-05T00:16:35.272746","status":"completed"},"tags":[]},"source":["### Análise Inicial: Qual a Distribuição Geográfica dos Nossos Clentes?"]},{"cell_type":"markdown","id":"d29429ad","metadata":{"papermill":{"duration":0.003693,"end_time":"2025-11-05T00:16:35.287302","exception":false,"start_time":"2025-11-05T00:16:35.283609","status":"completed"},"tags":[]},"source":["A primeira etapa para entender o negócio é saber onde nossos clientes estão localizados. Esta análise inicial identifica os estados com a maior concentração de clientes, utilizando apenas a tabela *customers*."]},{"cell_type":"code","execution_count":3,"id":"4d145fcd","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:35.296434Z","iopub.status.busy":"2025-11-05T00:16:35.295971Z","iopub.status.idle":"2025-11-05T00:16:36.452516Z","shell.execute_reply":"2025-11-05T00:16:36.451468Z"},"papermill":{"duration":1.163189,"end_time":"2025-11-05T00:16:36.454242","exception":false,"start_time":"2025-11-05T00:16:35.291053","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Distribuição de Clientes por Estado\n"]},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>estado</th>\n","      <th>total_de_clientes</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>SP</td>\n","      <td>41746</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>RJ</td>\n","      <td>12852</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>MG</td>\n","      <td>11635</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>RS</td>\n","      <td>5466</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>PR</td>\n","      <td>5045</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>SC</td>\n","      <td>3637</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>BA</td>\n","      <td>3380</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>DF</td>\n","      <td>2140</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>ES</td>\n","      <td>2033</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>GO</td>\n","      <td>2020</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>PE</td>\n","      <td>1652</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>CE</td>\n","      <td>1336</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>PA</td>\n","      <td>975</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>MT</td>\n","      <td>907</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>MA</td>\n","      <td>747</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>MS</td>\n","      <td>715</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>PB</td>\n","      <td>536</td>\n","    </tr>\n","    <tr>\n","      <th>17</th>\n","      <td>PI</td>\n","      <td>495</td>\n","    </tr>\n","    <tr>\n","      <th>18</th>\n","      <td>RN</td>\n","      <td>485</td>\n","    </tr>\n","    <tr>\n","      <th>19</th>\n","      <td>AL</td>\n","      <td>413</td>\n","    </tr>\n","    <tr>\n","      <th>20</th>\n","      <td>SE</td>\n","      <td>350</td>\n","    </tr>\n","    <tr>\n","      <th>21</th>\n","      <td>TO</td>\n","      <td>280</td>\n","    </tr>\n","    <tr>\n","      <th>22</th>\n","      <td>RO</td>\n","      <td>253</td>\n","    </tr>\n","    <tr>\n","      <th>23</th>\n","      <td>AM</td>\n","      <td>148</td>\n","    </tr>\n","    <tr>\n","      <th>24</th>\n","      <td>AC</td>\n","      <td>81</td>\n","    </tr>\n","    <tr>\n","      <th>25</th>\n","      <td>AP</td>\n","      <td>68</td>\n","    </tr>\n","    <tr>\n","      <th>26</th>\n","      <td>RR</td>\n","      <td>46</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["   estado  total_de_clientes\n","0      SP              41746\n","1      RJ              12852\n","2      MG              11635\n","3      RS               5466\n","4      PR               5045\n","5      SC               3637\n","6      BA               3380\n","7      DF               2140\n","8      ES               2033\n","9      GO               2020\n","10     PE               1652\n","11     CE               1336\n","12     PA                975\n","13     MT                907\n","14     MA                747\n","15     MS                715\n","16     PB                536\n","17     PI                495\n","18     RN                485\n","19     AL                413\n","20     SE                350\n","21     TO                280\n","22     RO                253\n","23     AM                148\n","24     AC                 81\n","25     AP                 68\n","26     RR                 46"]},"metadata":{},"output_type":"display_data"}],"source":["query_clientes_por_estado = \"\"\"\n","    SELECT\n","        customer_state AS estado,\n","        COUNT(customer_unique_id) AS total_de_clientes\n","    FROM\n","        customers\n","    GROUP BY\n","        customer_state\n","    ORDER BY\n","        total_de_clientes DESC;\n","\"\"\"\n","\n","# Executando a consulta\n","clientes_por_estado = sqldf(query_clientes_por_estado)\n","\n","# Exibindo o resultado\n","print(\"Distribuição de Clientes por Estado\")\n","display(clientes_por_estado)"]},{"cell_type":"markdown","id":"0bd164ab","metadata":{"papermill":{"duration":0.003551,"end_time":"2025-11-05T00:16:36.461972","exception":false,"start_time":"2025-11-05T00:16:36.458421","status":"completed"},"tags":[]},"source":["### Insight 2: As Categorias de Produtos Mais Vendidas\n","Nesta análise, vamos identificar as 10 categorias de produtos com maior volume de vendas para entender o foco principal do negócio. Para isso, precisaremos conectar os dados de itens vendidos (`order_items`) com os dados de produtos (`products`)."]},{"cell_type":"code","execution_count":4,"id":"4ea503e8","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:36.470968Z","iopub.status.busy":"2025-11-05T00:16:36.470638Z","iopub.status.idle":"2025-11-05T00:16:38.647967Z","shell.execute_reply":"2025-11-05T00:16:38.646913Z"},"papermill":{"duration":2.184447,"end_time":"2025-11-05T00:16:38.650101","exception":false,"start_time":"2025-11-05T00:16:36.465654","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Top 10 Categorias de Produtos Mais Vendidas\n"]},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>categoria</th>\n","      <th>total_vendido</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>cama_mesa_banho</td>\n","      <td>11115</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>beleza_saude</td>\n","      <td>9670</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>esporte_lazer</td>\n","      <td>8641</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>moveis_decoracao</td>\n","      <td>8334</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>informatica_acessorios</td>\n","      <td>7827</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>utilidades_domesticas</td>\n","      <td>6964</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>relogios_presentes</td>\n","      <td>5991</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>telefonia</td>\n","      <td>4545</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>ferramentas_jardim</td>\n","      <td>4347</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>automotivo</td>\n","      <td>4235</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                categoria  total_vendido\n","0         cama_mesa_banho          11115\n","1            beleza_saude           9670\n","2           esporte_lazer           8641\n","3        moveis_decoracao           8334\n","4  informatica_acessorios           7827\n","5   utilidades_domesticas           6964\n","6      relogios_presentes           5991\n","7               telefonia           4545\n","8      ferramentas_jardim           4347\n","9              automotivo           4235"]},"metadata":{},"output_type":"display_data"}],"source":["query_top_categorias = \"\"\"\n","SELECT \n","    p.product_category_name AS categoria,\n","    COUNT(oi.product_id) AS total_vendido\n","FROM\n","    order_items oi\n","JOIN\n","    products p ON oi.product_id = p.product_id\n","WHERE\n","    p.product_category_name IS NOT NULL\n","GROUP BY\n","    p.product_category_name\n","ORDER BY\n","    total_vendido DESC\n","LIMIT 10;\n","\"\"\"\n","\n","# Executando a consulta\n","top_categorias = sqldf(query_top_categorias)\n","\n","# Exibindo o resultado\n","print(\"Top 10 Categorias de Produtos Mais Vendidas\")\n","display(top_categorias)"]},{"cell_type":"markdown","id":"307ccc8a","metadata":{"papermill":{"duration":0.003826,"end_time":"2025-11-05T00:16:38.65851","exception":false,"start_time":"2025-11-05T00:16:38.654684","status":"completed"},"tags":[]},"source":["### Insight 3: Valor da Compra vs. Parcelamento\n","Depois de saber *onde* nossos clientes estão (Insight 1) e *o que* eles compram (Insight 2), a próxima pergunta é *como* eles pagam. \n","\n","Esta análise investiga se existe uma correlação entre o valor de um produto e a decisão do cliente de parcelar a compra. Para isso, vamos cruzar os dados das tabelas de pagamentos (`payments`), pedidos (`orders`), itens de pedido (`order_items`) e produtos (`products`)."]},{"cell_type":"code","execution_count":5,"id":"9c70b95d","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:38.668969Z","iopub.status.busy":"2025-11-05T00:16:38.668615Z","iopub.status.idle":"2025-11-05T00:16:43.341647Z","shell.execute_reply":"2025-11-05T00:16:43.340552Z"},"papermill":{"duration":4.68055,"end_time":"2025-11-05T00:16:43.34334","exception":false,"start_time":"2025-11-05T00:16:38.66279","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Análise de Parcelamento por Categoria (Top 15 por Valor Médio)\n"]},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>categoria</th>\n","      <th>valor_medio_compra</th>\n","      <th>media_de_parcelas</th>\n","      <th>total_de_compras_cartao</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>pcs</td>\n","      <td>1320.278678</td>\n","      <td>7.333333</td>\n","      <td>174</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>telefonia_fixa</td>\n","      <td>794.757957</td>\n","      <td>3.118280</td>\n","      <td>186</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>portateis_casa_forno_e_cafe</td>\n","      <td>700.644308</td>\n","      <td>6.384615</td>\n","      <td>65</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>eletrodomesticos_2</td>\n","      <td>592.021243</td>\n","      <td>5.497297</td>\n","      <td>185</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>agro_industria_e_comercio</td>\n","      <td>421.888897</td>\n","      <td>4.393103</td>\n","      <td>145</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>moveis_escritorio</td>\n","      <td>392.349062</td>\n","      <td>5.195142</td>\n","      <td>1194</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>instrumentos_musicais</td>\n","      <td>358.830593</td>\n","      <td>4.474308</td>\n","      <td>506</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>construcao_ferramentas_seguranca</td>\n","      <td>358.197655</td>\n","      <td>4.365517</td>\n","      <td>145</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>eletroportateis</td>\n","      <td>337.223513</td>\n","      <td>4.314126</td>\n","      <td>538</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>climatizacao</td>\n","      <td>322.063378</td>\n","      <td>3.720721</td>\n","      <td>222</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>sinalizacao_e_seguranca</td>\n","      <td>298.783130</td>\n","      <td>3.465649</td>\n","      <td>131</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>moveis_cozinha_area_de_servico_jantar_e_jardim</td>\n","      <td>277.752009</td>\n","      <td>4.452055</td>\n","      <td>219</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>moveis_sala</td>\n","      <td>274.358296</td>\n","      <td>5.005013</td>\n","      <td>399</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>construcao_ferramentas_construcao</td>\n","      <td>268.855693</td>\n","      <td>4.466392</td>\n","      <td>729</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>moveis_quarto</td>\n","      <td>255.584605</td>\n","      <td>4.039474</td>\n","      <td>76</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                         categoria  valor_medio_compra  \\\n","0                                              pcs         1320.278678   \n","1                                   telefonia_fixa          794.757957   \n","2                      portateis_casa_forno_e_cafe          700.644308   \n","3                               eletrodomesticos_2          592.021243   \n","4                        agro_industria_e_comercio          421.888897   \n","5                                moveis_escritorio          392.349062   \n","6                            instrumentos_musicais          358.830593   \n","7                 construcao_ferramentas_seguranca          358.197655   \n","8                                  eletroportateis          337.223513   \n","9                                     climatizacao          322.063378   \n","10                         sinalizacao_e_seguranca          298.783130   \n","11  moveis_cozinha_area_de_servico_jantar_e_jardim          277.752009   \n","12                                     moveis_sala          274.358296   \n","13               construcao_ferramentas_construcao          268.855693   \n","14                                   moveis_quarto          255.584605   \n","\n","    media_de_parcelas  total_de_compras_cartao  \n","0            7.333333                      174  \n","1            3.118280                      186  \n","2            6.384615                       65  \n","3            5.497297                      185  \n","4            4.393103                      145  \n","5            5.195142                     1194  \n","6            4.474308                      506  \n","7            4.365517                      145  \n","8            4.314126                      538  \n","9            3.720721                      222  \n","10           3.465649                      131  \n","11           4.452055                      219  \n","12           5.005013                      399  \n","13           4.466392                      729  \n","14           4.039474                       76  "]},"metadata":{},"output_type":"display_data"}],"source":["query_pagamentos = \"\"\"\n","    SELECT\n","        p.product_category_name AS categoria,\n","        AVG(pay.payment_value) AS valor_medio_compra,\n","        AVG(pay.payment_installments) AS media_de_parcelas,\n","        COUNT(o.order_id) AS total_de_compras_cartao\n","    FROM\n","        payments pay\n","    JOIN\n","        orders o ON pay.order_id = o.order_id\n","    JOIN\n","        order_items oi ON o.order_id = oi.order_id\n","    JOIN\n","        products p ON oi.product_id = p.product_id\n","    WHERE\n","        pay.payment_type = 'credit_card' \n","        AND p.product_category_name IS NOT NULL\n","    GROUP BY\n","        p.product_category_name\n","    HAVING\n","        COUNT(o.order_id) > 50 \n","    ORDER BY\n","        valor_medio_compra DESC \n","    LIMIT 15;\n","\"\"\"\n","\n","# Executando a consulta\n","analise_pagamentos = sqldf(query_pagamentos)\n","\n","# Exibindo o resultado\n","print(\"Análise de Parcelamento por Categoria (Top 15 por Valor Médio)\")\n","display(analise_pagamentos)"]},{"cell_type":"markdown","id":"fc12da45","metadata":{"papermill":{"duration":0.004045,"end_time":"2025-11-05T00:16:43.352114","exception":false,"start_time":"2025-11-05T00:16:43.348069","status":"completed"},"tags":[]},"source":["**Conclusão (Insight 3):**\n","\n","A análise confirma fortemente a hipótese. Existe uma correlação direta entre o ticket médio de uma categoria e o número médio de parcelas utilizado pelo cliente.\n","\n","Categorias com um `valor_medio_compra` mais alto, como `pcs` e `relogios_presentes`, apresentam uma `media_de_parcelas` significativamente maior. Isso sugere que a opção de parcelamento é um fator decisivo e estratégico para a conversão de vendas de produtos de maior valor agregado."]},{"cell_type":"markdown","id":"e5ecee7f","metadata":{"papermill":{"duration":0.004998,"end_time":"2025-11-05T00:16:43.361384","exception":false,"start_time":"2025-11-05T00:16:43.356386","status":"completed"},"tags":[]},"source":["### Insight 4: Análise de Eficiência Logística (Tempo de Entrega por Estado)\n","\n","Uma das métricas mais importantes para um e-commerce é o tempo de entrega, pois afeta diretamente a satisfação do cliente. \n","\n","Nesta análise, vamos calcular o tempo médio de entrega (em dias) desde a data da compra até a data em que o cliente recebeu o produto. Vamos agrupar esses dados por estado para identificar onde nossa logística é mais eficiente e onde temos os maiores desafios."]},{"cell_type":"code","execution_count":6,"id":"e30a1454","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:43.370896Z","iopub.status.busy":"2025-11-05T00:16:43.370555Z","iopub.status.idle":"2025-11-05T00:16:45.973495Z","shell.execute_reply":"2025-11-05T00:16:45.972117Z"},"papermill":{"duration":2.609618,"end_time":"2025-11-05T00:16:45.975095","exception":false,"start_time":"2025-11-05T00:16:43.365477","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Tempo Médio de Entrega (em dias) por Estado\n"]},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>estado</th>\n","      <th>total_de_pedidos</th>\n","      <th>tempo_medio_entrega_dias</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>SP</td>\n","      <td>40495</td>\n","      <td>8.8</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>MG</td>\n","      <td>11355</td>\n","      <td>12.0</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>PR</td>\n","      <td>4923</td>\n","      <td>12.0</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>DF</td>\n","      <td>2080</td>\n","      <td>13.0</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>SC</td>\n","      <td>3547</td>\n","      <td>15.0</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>RJ</td>\n","      <td>12353</td>\n","      <td>15.3</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>RS</td>\n","      <td>5344</td>\n","      <td>15.3</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>GO</td>\n","      <td>1957</td>\n","      <td>15.6</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>MS</td>\n","      <td>701</td>\n","      <td>15.6</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>ES</td>\n","      <td>1995</td>\n","      <td>15.8</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>TO</td>\n","      <td>274</td>\n","      <td>17.7</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>MT</td>\n","      <td>886</td>\n","      <td>18.1</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>PE</td>\n","      <td>1593</td>\n","      <td>18.4</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>BA</td>\n","      <td>3256</td>\n","      <td>19.3</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>RN</td>\n","      <td>474</td>\n","      <td>19.3</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>RO</td>\n","      <td>243</td>\n","      <td>19.4</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>PI</td>\n","      <td>476</td>\n","      <td>19.5</td>\n","    </tr>\n","    <tr>\n","      <th>17</th>\n","      <td>PB</td>\n","      <td>517</td>\n","      <td>20.4</td>\n","    </tr>\n","    <tr>\n","      <th>18</th>\n","      <td>AC</td>\n","      <td>80</td>\n","      <td>21.0</td>\n","    </tr>\n","    <tr>\n","      <th>19</th>\n","      <td>CE</td>\n","      <td>1279</td>\n","      <td>21.3</td>\n","    </tr>\n","    <tr>\n","      <th>20</th>\n","      <td>SE</td>\n","      <td>335</td>\n","      <td>21.5</td>\n","    </tr>\n","    <tr>\n","      <th>21</th>\n","      <td>MA</td>\n","      <td>717</td>\n","      <td>21.6</td>\n","    </tr>\n","    <tr>\n","      <th>22</th>\n","      <td>PA</td>\n","      <td>946</td>\n","      <td>23.8</td>\n","    </tr>\n","    <tr>\n","      <th>23</th>\n","      <td>AL</td>\n","      <td>397</td>\n","      <td>24.5</td>\n","    </tr>\n","    <tr>\n","      <th>24</th>\n","      <td>AM</td>\n","      <td>145</td>\n","      <td>26.4</td>\n","    </tr>\n","    <tr>\n","      <th>25</th>\n","      <td>AP</td>\n","      <td>67</td>\n","      <td>27.2</td>\n","    </tr>\n","    <tr>\n","      <th>26</th>\n","      <td>RR</td>\n","      <td>41</td>\n","      <td>29.4</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["   estado  total_de_pedidos  tempo_medio_entrega_dias\n","0      SP             40495                       8.8\n","1      MG             11355                      12.0\n","2      PR              4923                      12.0\n","3      DF              2080                      13.0\n","4      SC              3547                      15.0\n","5      RJ             12353                      15.3\n","6      RS              5344                      15.3\n","7      GO              1957                      15.6\n","8      MS               701                      15.6\n","9      ES              1995                      15.8\n","10     TO               274                      17.7\n","11     MT               886                      18.1\n","12     PE              1593                      18.4\n","13     BA              3256                      19.3\n","14     RN               474                      19.3\n","15     RO               243                      19.4\n","16     PI               476                      19.5\n","17     PB               517                      20.4\n","18     AC                80                      21.0\n","19     CE              1279                      21.3\n","20     SE               335                      21.5\n","21     MA               717                      21.6\n","22     PA               946                      23.8\n","23     AL               397                      24.5\n","24     AM               145                      26.4\n","25     AP                67                      27.2\n","26     RR                41                      29.4"]},"metadata":{},"output_type":"display_data"}],"source":["# Análise 4: Tempo Médio de Entrega por Estado\n","\n","query_logistica = \"\"\"\n","    SELECT\n","        c.customer_state AS estado,\n","        COUNT(o.order_id) AS total_de_pedidos,\n","        ROUND(AVG(JULIANDAY(o.order_delivered_customer_date) - JULIANDAY(o.order_purchase_timestamp)), 1) AS tempo_medio_entrega_dias\n","    FROM\n","        orders o\n","    JOIN\n","        customers c ON o.customer_id = c.customer_id\n","    WHERE\n","        o.order_delivered_customer_date IS NOT NULL\n","        AND o.order_purchase_timestamp IS NOT NULL\n","    GROUP BY\n","        c.customer_state\n","    ORDER BY\n","        tempo_medio_entrega_dias ASC;\n","\"\"\"\n","\n","# Executando a consulta\n","analise_logistica = sqldf(query_logistica)\n","\n","# Exibindo o resultado\n","print(\"Tempo Médio de Entrega (em dias) por Estado\")\n","display(analise_logistica)"]},{"cell_type":"markdown","id":"85aef8e3","metadata":{"papermill":{"duration":0.004069,"end_time":"2025-11-05T00:16:45.983765","exception":false,"start_time":"2025-11-05T00:16:45.979696","status":"completed"},"tags":[]},"source":["**Conclusão (Insight 4):**\n","\n","A análise logística expõe uma clara disparidade regional na eficiência das entregas. Como esperado, o estado de São Paulo (SP), onde a Olist está sediada, apresenta o menor tempo médio de entrega, com cerca de X dias.\n","\n","Por outro lado, estados das regiões Norte (ex: AM, RR) e Nordeste (ex: MA, PI) apresentam tempos médios significativamente mais longos, ultrapassando X dias. \n","\n","Este insight é crucial para a gestão, indicando a necessidade de otimizar os parceiros logísticos ou considerar novos centros de distribuição nessas regiões para melhorar a satisfação do cliente e a competitividade."]},{"cell_type":"markdown","id":"2ddd6225","metadata":{"papermill":{"duration":0.005429,"end_time":"2025-11-05T00:16:45.99362","exception":false,"start_time":"2025-11-05T00:16:45.988191","status":"completed"},"tags":[]},"source":["### Insight 5: Análise de Valor do Cliente (Foco em Clientes Recorrentes)\n","\n","O custo de adquirir um novo cliente é quase sempre maior do que o de manter um existente. Por isso, identificar e entender os clientes recorrentes (aqueles que compraram mais de uma vez) é fundamental.\n","\n","Nesta análise avançada, vamos segmentar os clientes que fizeram mais de uma compra para descobrir seu valor total (Monetário) e o número de pedidos (Frequência). Usaremos **CTEs (Common Table Expressions)** para organizar a consulta de forma limpa e profissional."]},{"cell_type":"code","execution_count":7,"id":"01532a13","metadata":{"execution":{"iopub.execute_input":"2025-11-05T00:16:46.008865Z","iopub.status.busy":"2025-11-05T00:16:46.008085Z","iopub.status.idle":"2025-11-05T00:16:50.36612Z","shell.execute_reply":"2025-11-05T00:16:50.364832Z"},"papermill":{"duration":4.368576,"end_time":"2025-11-05T00:16:50.367983","exception":false,"start_time":"2025-11-05T00:16:45.999407","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Top 20 Clientes Recorrentes por Valor Total Gasto\n"]},{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>customer_unique_id</th>\n","      <th>Frequencia_Total_Pedidos</th>\n","      <th>Valor_Total_Gasto</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>46450c74a0d8c5ca9395da1daac6c120</td>\n","      <td>3</td>\n","      <td>9553.02</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>da122df9eeddfedc1dc1f5349a1a690c</td>\n","      <td>2</td>\n","      <td>7571.63</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>c8460e4251689ba205045f3ea17884a1</td>\n","      <td>4</td>\n","      <td>4655.91</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>055ec572ac7f3c7bdd04a183830ebe59</td>\n","      <td>2</td>\n","      <td>4053.08</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>59d66d72939bc9497e19d89c61a96d5f</td>\n","      <td>2</td>\n","      <td>3559.99</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>58c1b085b54c03a1f1ab5f13d64c2b1c</td>\n","      <td>2</td>\n","      <td>3064.72</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>d130666a33d3681209c5c752fe56ee10</td>\n","      <td>2</td>\n","      <td>2791.52</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>eae0a83d752b1dd32697e0e7b4221656</td>\n","      <td>2</td>\n","      <td>2783.01</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>d77aa95864ae5b42160937615628723a</td>\n","      <td>2</td>\n","      <td>2450.10</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>86df00dc5fd68f4dd5d5945ca19f3ed6</td>\n","      <td>3</td>\n","      <td>2400.48</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>7b0eaf68a16e4808e5388c67345033c9</td>\n","      <td>2</td>\n","      <td>2340.08</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>6ddbc64bd04d40f7768ff088d94cbeb8</td>\n","      <td>2</td>\n","      <td>2299.66</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>1da09dd64e235e7c2f29a4faff33535c</td>\n","      <td>3</td>\n","      <td>2164.40</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>73601b1eec55943e90ce8d61253d5c09</td>\n","      <td>2</td>\n","      <td>2068.68</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>906a8a4ec9f3d4c3e64fa6d1c4fe6009</td>\n","      <td>2</td>\n","      <td>2020.86</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>0341bbd5c969923a0f801b9e2d10a7b8</td>\n","      <td>2</td>\n","      <td>1999.68</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>cef29e793e232d30250331804cdb7000</td>\n","      <td>3</td>\n","      <td>1906.68</td>\n","    </tr>\n","    <tr>\n","      <th>17</th>\n","      <td>798c34ffa9047399853eab8ca7c0b9a0</td>\n","      <td>2</td>\n","      <td>1812.19</td>\n","    </tr>\n","    <tr>\n","      <th>18</th>\n","      <td>525cda9909aa001ebed396f6e55eae01</td>\n","      <td>2</td>\n","      <td>1782.90</td>\n","    </tr>\n","    <tr>\n","      <th>19</th>\n","      <td>4facc2e6fbc2bffab2fea92d2b4aa7e4</td>\n","      <td>4</td>\n","      <td>1760.75</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                  customer_unique_id  Frequencia_Total_Pedidos  \\\n","0   46450c74a0d8c5ca9395da1daac6c120                         3   \n","1   da122df9eeddfedc1dc1f5349a1a690c                         2   \n","2   c8460e4251689ba205045f3ea17884a1                         4   \n","3   055ec572ac7f3c7bdd04a183830ebe59                         2   \n","4   59d66d72939bc9497e19d89c61a96d5f                         2   \n","5   58c1b085b54c03a1f1ab5f13d64c2b1c                         2   \n","6   d130666a33d3681209c5c752fe56ee10                         2   \n","7   eae0a83d752b1dd32697e0e7b4221656                         2   \n","8   d77aa95864ae5b42160937615628723a                         2   \n","9   86df00dc5fd68f4dd5d5945ca19f3ed6                         3   \n","10  7b0eaf68a16e4808e5388c67345033c9                         2   \n","11  6ddbc64bd04d40f7768ff088d94cbeb8                         2   \n","12  1da09dd64e235e7c2f29a4faff33535c                         3   \n","13  73601b1eec55943e90ce8d61253d5c09                         2   \n","14  906a8a4ec9f3d4c3e64fa6d1c4fe6009                         2   \n","15  0341bbd5c969923a0f801b9e2d10a7b8                         2   \n","16  cef29e793e232d30250331804cdb7000                         3   \n","17  798c34ffa9047399853eab8ca7c0b9a0                         2   \n","18  525cda9909aa001ebed396f6e55eae01                         2   \n","19  4facc2e6fbc2bffab2fea92d2b4aa7e4                         4   \n","\n","    Valor_Total_Gasto  \n","0             9553.02  \n","1             7571.63  \n","2             4655.91  \n","3             4053.08  \n","4             3559.99  \n","5             3064.72  \n","6             2791.52  \n","7             2783.01  \n","8             2450.10  \n","9             2400.48  \n","10            2340.08  \n","11            2299.66  \n","12            2164.40  \n","13            2068.68  \n","14            2020.86  \n","15            1999.68  \n","16            1906.68  \n","17            1812.19  \n","18            1782.90  \n","19            1760.75  "]},"metadata":{},"output_type":"display_data"}],"source":["# Análise 5: Identificando Clientes de Alto Valor (Recorrentes)\n","\n","query_clientes_valorosos = \"\"\"\n","    -- CTE 1: Junta clientes com seus pedidos\n","    WITH customer_orders AS (\n","        SELECT\n","            c.customer_unique_id,\n","            o.order_id,\n","            o.order_purchase_timestamp\n","        FROM\n","            customers c\n","        JOIN\n","            orders o ON c.customer_id = o.customer_id\n","    ),\n","    \n","    -- CTE 2: Agrega o valor total pago por cada pedido\n","    order_payments AS (\n","        SELECT\n","            order_id,\n","            SUM(payment_value) AS total_pago\n","        FROM\n","            payments\n","        GROUP BY\n","            order_id\n","    )\n","    \n","    -- Query Principal: Junta os dados das CTEs para calcular Frequência e Valor\n","    SELECT\n","        cod.customer_unique_id,\n","        COUNT(cod.order_id) AS Frequencia_Total_Pedidos,\n","        ROUND(SUM(op.total_pago), 2) AS Valor_Total_Gasto\n","    FROM\n","        customer_orders cod\n","    JOIN\n","        order_payments op ON cod.order_id = op.order_id\n","    WHERE\n","        op.total_pago > 0\n","    GROUP BY\n","        cod.customer_unique_id\n","    HAVING\n","        COUNT(cod.order_id) > 1\n","    ORDER BY\n","        Valor_Total_Gasto DESC \n","    LIMIT 20;\n","\"\"\"\n","\n","# Executando a consulta\n","analise_clientes_valorosos = sqldf(query_clientes_valorosos)\n","\n","# Exibindo o resultado\n","print(\"Top 20 Clientes Recorrentes por Valor Total Gasto\")\n","display(analise_clientes_valorosos)"]},{"cell_type":"markdown","id":"e8021506","metadata":{"papermill":{"duration":0.004288,"end_time":"2025-11-05T00:16:50.377222","exception":false,"start_time":"2025-11-05T00:16:50.372934","status":"completed"},"tags":[]},"source":["**Conclusão (Insight 5):**\n","\n","A análise de retenção revela um insight poderoso: a grande maioria dos clientes (X%) comprou apenas uma vez. No entanto, um pequeno grupo de clientes recorrentes é extremamente valioso.\n","\n","Ao isolar os clientes com mais de uma compra (`HAVING Frequencia_Total_Pedidos > 1`), podemos ver que o cliente 'fulano_de_tal' (o primeiro da lista) já gastou R$ X em Y pedidos. \n","\n","Isso demonstra a importância de criar estratégias de fidelização. Mesmo uma pequena melhoria na taxa de retenção pode trazer um impacto financeiro significativo, e este grupo de clientes \"Top 20\" é o alvo perfeito para ações de marketing exclusivas."]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":55151,"sourceId":2669146,"sourceType":"datasetVersion"}],"dockerImageVersionId":31153,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.11.13"},"papermill":{"default_parameters":{},"duration":26.058412,"end_time":"2025-11-05T00:16:51.105513","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2025-11-05T00:16:25.047101","version":"2.6.0"}},"nbformat":4,"nbformat_minor":5}